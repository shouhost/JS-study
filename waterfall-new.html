<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>JS取商取余</title>
    <style>
    *{margin:0;padding:0;}ul{float:left;width:100%;}ul,li{list-style:none;}img{width:150px;}.box{float: left;padding:5px;}.box-img{padding:5px;border:1px solid #ccc; box-shadow:0 0 5px #CCC;border-radius:5px;}
    .clearfix:after{content:".";display:block;height:0;clear:both;visibility:hidden}
.clearfix{*+height:1%;}
    </style>
</head>

<body>
	<div class="clearfix" id="container">
		<ul>
			<li class="box">
				<div class="box-img"><img src="img/1.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/2.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/3.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/4.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/5.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/6.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/7.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/8.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/9.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/10.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/11.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/12.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/13.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/14.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/15.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/13.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/14.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/15.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/13.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/14.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/14.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/15.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/13.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/14.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/14.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/15.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/13.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/14.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/14.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/15.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/13.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/14.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/15.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/13.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/14.jpg"></div>
			</li>
			<li class="box">
				<div class="box-img"><img src="img/15.jpg"></div>
			</li>
		</ul>
	</div>
</body>

<script>
window.onload=function () {
	imgLocation("#container",".box");

	var imgData = {"data":[{"src":"2.jpg"},{"src":"1.jpg"},{"src":"4.jpg"},{"src":"5.jpg"},{"src":"7.jpg"},{"src":"8.jpg"},{"src":"9.jpg"}]};
	window.onscroll = function(){
		if (checkFlag()) {
			var oparent = document.querySelector("#container ul");
			console.log(oparent);
			for (var i = 0; i < imgData.data.length; i++) {
				var ocontent = document.createElement("li");
				ocontent.className="box";
				oparent.appendChild(ocontent);
				var boximg = document.createElement("div");
				boximg.className="box-img";
				ocontent.appendChild(boximg);
				var img =document.createElement("img");
				img.src="img/"+imgData.data[i].src;
				boximg.appendChild(img);
			}
			imgLocation("#container",".box");
		}
	}

	window.onresize = function(){
		imgLocation("#container",".box");
	}
}


function checkFlag(){
	var oparent = document.querySelector("#container");
	var ocont = document.querySelectorAll(".box");
	var lastContHeight = ocont[ocont.length-1].offsetTop;
	var scrollTop = document.documentElement.scrollTop||document.body.scrollTop;
	var pageHeight = document.documentElement.clientHeight||document.body.clientHeight;
	if ( lastContHeight < scrollTop+pageHeight ) {
		return true;
	}

}

function imgLocation(parent,cont){
	var oparent = document.querySelector(parent);
	var ocont = document.querySelectorAll(cont);
	var imgWidth = ocont[0].offsetWidth;	
	var num = parseInt(document.documentElement.clientWidth / imgWidth);
	oparent.style.cssText = "width:"+imgWidth * num +"px;margin:0 auto;";
	var boxHeightArr = [];
	for (var i = 0; i < ocont.length; i++) {
		if(i<num){
			boxHeightArr[i]=ocont[i].offsetHeight;
			ocont[i].style.position = 'static';
		}else{
			var minHeight = Math.min.apply(null,boxHeightArr);
			var minIndex = getminheightIndex(boxHeightArr,minHeight);
			ocont[i].style.position = 'absolute';
			ocont[i].style.top = minHeight +"px";
			ocont[i].style.left = ocont[minIndex].offsetLeft+"px";
			boxHeightArr[minIndex]=boxHeightArr[minIndex]+ocont[i].offsetHeight;
		}
	}
}

function getminheightIndex(boxheightArr,minHeight){
	for (var i in boxheightArr) {
		if (boxheightArr[i] == minHeight) {
			return i;
		}
	}
}

</script>

</html>
